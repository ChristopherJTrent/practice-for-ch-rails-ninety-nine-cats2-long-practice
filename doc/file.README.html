<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.34
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><h1 id="cats-ii-auth">99 Cats II: Auth</h1>

<p><strong><a href="https://aa-99-cats.herokuapp.com/">Live Demo!</a></strong></p>

<p>Today you will add users and login capabilities to your 99Cats application.</p>

<h2 id="learning-goals">Learning goals</h2>

<ul>
  <li>Be able to create a user authentication system
    <ul>
      <li>Know the user model’s methods that are required for authentication
        <ul>
          <li><code>reset_session_token</code>, <code>password=</code>, <code>is_password?</code>, <code>find_by_credentials</code></li>
        </ul>
      </li>
      <li>Know what it means to create and destroy a session</li>
      <li>Know how cookies and sessions interact in a <code>current_user</code> method</li>
      <li>Know how to access the current user from within a view</li>
    </ul>
  </li>
</ul>

<h2 id="setup">Setup</h2>

<p>This is Part II of yesterday’s project. Instead of using yesterday’s code,
however, clone the starter repo (i.e., yesterday’s solution) from the <code>Download
Project</code> button below and use it for your work today. This will ensure that 1)
everyone has a complete Part I to start from; 2) you and your partner have the
same codebase; and 3) you don’t have to spend time today debugging code
from yesterday.</p>

<p>Since you will be implementing authentication, you need the <code>bcrypt</code> gem. Add it
to the top level of your <strong>Gemfile</strong> and <code>bundle install</code>.</p>

<p>Don’t forget to create your db!</p>

<h2 id="phase-iv-users">Phase IV: Users</h2>

<p>You will start today’s work by building user functionality.</p>

<h3 id="add-a-user-model">Add a <code>User</code> model</h3>

<ul>
  <li>Store the <code>User</code>’s <code>username</code> and <code>password_digest</code>.
    <ul>
      <li>Make the <code>username</code> unique.</li>
      <li>As ever, toss on necessary constraints and validations.</li>
    </ul>
  </li>
  <li>Also create a <code>session_token</code> column.
    <ul>
      <li>Require the session token to be present. This means you’ll need a
<code>before_validation</code> callback to set the token if it’s not already set.</li>
      <li>Add a unique index on <code>session_token</code>; no two users should share a session
token.</li>
    </ul>
  </li>
  <li>Write a <code>#password=(password)</code> setter method that writes the <code>password_digest</code>
attribute with the hash of the given password.</li>
  <li>Write a <code>#is_password?(password)</code> method that verifies a password.</li>
  <li>Write a <code>::find_by_credentials(username, password)</code> method that returns the
user with the given name if the password is correct.</li>
  <li>Write a private <code>#generate_unique_session_token</code> method to generate a unique
token using <code>SecureRandom</code>.</li>
  <li>Write yourself a <code>#reset_session_token!</code> method. Go on, you’re worth it!</li>
  <li>Write a private <code>#ensure_session_token</code> method that supplies a session token
if the user does not have one.</li>
</ul>

<h3 id="userscontroller-sessionscontroller"><code>UsersController</code>, <code>SessionsController</code></h3>

<p>To allow a user to sign up, write a <code>UsersController</code> with <code>new</code> and <code>create</code>
actions. Add appropriate routes.</p>

<p>Build a <code>SessionsController</code>:</p>

<ul>
  <li>Add a singular <code>:session</code> resource in <strong>routes.rb</strong>
    <ul>
      <li>A visitor to your site implicitly has their own session (it’s stored in
their browser), so there’s no need to create routes for different sessions.
Only <code>new</code>, <code>create</code>, and <code>destroy</code> are needed.</li>
    </ul>
  </li>
  <li>In <code>SessionsController#new</code>:
    <ul>
      <li>Render a form for the user to input their username and password.</li>
    </ul>
  </li>
  <li>In <code>SessionsController#create</code>:
    <ul>
      <li>Verify the <code>user_name</code>/<code>password</code>.</li>
      <li>Reset the <code>User</code>’s <code>session_token</code>.</li>
      <li>Update the <code>session</code> hash with the new <code>session_token</code>.</li>
      <li>Redirect the user to the cats index page.</li>
    </ul>
  </li>
  <li>Don’t worry about <code>SessionsController#destroy</code> yet; you’ll get to it in the
next section.</li>
  <li>Don’t forget to add the corresponding views!</li>
</ul>

<h3 id="using-the-session">Using the session</h3>

<ul>
  <li>In the <code>ApplicationController</code>, write a method <code>current_user</code> that looks up
the user with the current session token.
    <ul>
      <li>Since all your controllers inherit from <code>ApplicationController</code>, this lets
you use the method in any controller.</li>
      <li>
        <p>Methods defined on <code>ApplicationController</code> still aren’t available in your
views. You’ll want to use <code>current_user</code> there too, so you need to make it a
<a href="https://api.rubyonrails.org/classes/AbstractController/Helpers/ClassMethods.html#method-i-helper_method"><code>helper_method</code></a>. Add this line to the top of
<code>ApplicationController</code>:</p>

        <p><code>ruby
helper_method :current_user
</code></p>
      </li>
    </ul>
  </li>
  <li>Use <code>current_user</code> to implement <code>SessionsController#destroy</code>.
    <ul>
      <li>Call <code>#reset_session_token!</code> on <code>current_user</code> to invalidate the old token,
but only if there is a <code>current_user</code>. Invalidating the old token guarantees
that no one can log in with it. This is good practice in case someone has
stolen the token.</li>
      <li>Set <code>:session_token</code> to <code>nil</code> in the <code>session</code> hash.</li>
    </ul>
  </li>
  <li>Edit the <strong>application.html.erb</strong> layout and create a header at the top:
    <ul>
      <li>Show the <code>username</code> if the user is signed in.</li>
      <li>Show a login or logout button, depending on whether a user is signed in.</li>
    </ul>
  </li>
  <li>Be sure to log in a new user as soon as they sign up. Nothing is more
frustrating than going through the whole sign-up process only to be redirected
back to the login page. Bad form.</li>
  <li>At this point, you should probably factor out the login code from
<code>SessionsController#create</code> into an <code>ApplicationController#login!</code> method
so that you can use it in <code>UsersController</code> for this purpose.</li>
  <li>In the <code>User</code> and <code>Session</code> controllers, redirect a user to the cats index if
the user tries to visit the login/sign-up pages when they’re already signed
in.
    <ul>
      <li>Use a <a href="https://guides.rubyonrails.org/action_controller_overview.html#filters"><code>before_action</code></a> filter at the top of each controller to accomplish
this.</li>
      <li>Write the filter method in <strong>application_controller.rb</strong> so it can be
accessed in both <code>UsersController</code> and <code>SessionsController</code>.</li>
      <li>
        <p>Name the filter <code>require_logged_out</code>. It should simply redirect a user to
the cats index if there is a current user.</p>

        <blockquote>
          <p>Note: If a render or redirect happens inside a <code>before_action</code> filter,
Rails will abandon the original request. Neither the originally targeted
action nor any subsequent filters will execute.</p>
        </blockquote>
      </li>
    </ul>
  </li>
</ul>

<p>Good work! Now head to Phase V.</p>

</div></div>

      <div id="footer">
  Generated on Mon Feb 19 13:20:58 2024 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.34 (ruby-3.1.1).
</div>

    </div>
  </body>
</html>